# Global options
{
	admin off
	persist_config off
	auto_https off
	
	log {
		format json
	}
	
	servers {
		trusted_proxies static private_ranges 100.0.0.0/8
	}
}

# Server block
:{$PORT:3000} {
	log {
		format json
	}

	# Health check
	rewrite /health /*

	# Serve from dist folder
	root * dist
	
	# Enable gzip
	encode gzip

	# Serve files, fallback to index.html for SPA routing
	try_files {path} /index.html
	file_server

	# Cache static assets
	@static {
		path *.js *.css *.woff *.woff2 *.ttf *.eot *.ico *.png *.jpg *.jpeg *.gif *.svg *.webp
	}
	header @static Cache-Control "public, max-age=31536000, immutable"
}
